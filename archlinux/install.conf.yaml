- defaults:
    link:
      relink: true

- create:
    - /home/ak/.ssh
    - /etc/X11/xorg.conf.d
    - /etc/dnscrypt-proxy
    - /home/ak/.gnupg

- link:
   /etc/systemd/system/reflector.service:
     path: /home/ak/.dotfiles/archlinux/systemd/system/reflector.service
   /etc/systemd/system/reflector.timer:
     path: /home/ak/.dotfiles/archlinux/systemd/system/reflector.timer
   /etc/dnsmasq.conf:
     force: true
     path: /home/ak/.dotfiles/archlinux/etc/dnsmasq.conf
   /etc/X11/xorg.conf.d/50-synaptics-t440s.conf:
     path: /home/ak/.dotfiles/archlinux/etc/X11/xorg.conf.d/50-synaptics-t440s.conf
   /home/ak/.ssh/config:
     path: /home/ak/.dotfiles/archlinux/home/ssh/config
     force: true
     create: true
   /home/ak/.gnupg/gpg-agent.conf:
     path: /home/ak/.dotfiles/archlinux/home/gnupg/gpg-agent.conf
     create: true
   /home/ak/.gnupg/gpg.conf:
     path: /home/ak/.dotfiles/archlinux/home/gnupg/gpg.conf
   /home/ak/.gitconfig:
     path: /home/ak/.dotfiles/archlinux/home/gitconfig
   /home/ak/.zshrc:
     path: /home/ak/.dotfiles/archlinux/home/zshrc
   /home/ak/.zpreztorc:
     path: /home/ak/.dotfiles/archlinux/home/zpreztorc
   /home/ak/.yubico:
     path: /home/ak/.dotfiles/archlinux/home/yubico
   /etc/pacman.d/hooks/98-secureboot.hook:
     path: /home/ak/.dotfiles/archlinux/etc/pacman.d/hooks/98-secureboot.hook
   /etc/pacman.d/hooks/99-initramfs-chmod.hook:
     path: /home/ak/.dotfiles/archlinux/etc/pacman.d/hooks/99-initramfs-chmod.hook
   /etc/pam.d/system-auth:
     path: /home/ak/.dotfiles/archlinux/etc/pam.d/system-auth
     force: true

- shell:
  - cp /home/ak/.dotfiles/archlinux/etc/dnscrypt-proxy.toml /etc/dnscrypt-proxy/dnscrypt-proxy.toml
  - chmod 0444 /etc/dnscrypt-proxy/dnscrypt-proxy.toml
  - chown 0600 /home/ak/.yubico
  - chattr -i /etc/resolv.conf
  - rm /etc/resolv.conf
  - ln -s /home/ak/.dotfiles/archlinux/etc/resolv.conf /etc/resolv.conf
  - chattr +i /home/ak/.dotfiles/archlinux/etc/resolv.conf
